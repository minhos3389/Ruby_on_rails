# MVC-CR구현

## CRUD
### Create/Read/Update/Delete 
### 게시판의 기본적인 기능

## Rails 개발 순서
### 1. 컨트롤러만들기 
### 2. 액션 만들기
### 3. 라우트 작성하기
### 4. 액션 이름대로 .html.erb (뷰파일) 만들기

## 게시판 작성 순서
### new.html.erb -> create액션 -> index.html.erb 
### 글을 작성하는 양식 : new.html.erb
### create 액션으로 db에 저장
### index.html.erb에서 정보를 전체목록으로 보여줌.

## 변수
- 일시적으로 정보를 저장
- 계속해서 여러가지 정보를 쌓아가는데 문제가 있다.

## DB == 영구적으로 정보를 저장
- DB와 작업하려면 Model이 필요.
- 글들을 DB에 저장하고, Model을 통해서 DB관리

# 게시판 작성 실습을 위한 새로운 프로젝트 생성
## 컨트롤러를 생성하면서 액션과 뷰파일(erb파일) 같이 생성할 수 있다.
## route도 미리 지정된다.
```shell
# prompt창에입력
# index, new, create 액션과 뷰를 가진 home이라는 컨트롤러를 생성해라
# home이라는 컨트롤러를 만들면서 컨트롤러 이름뒤, index,new,create 입력하면 액션 및 view파일  자동 생성된다.
rails g controller home index new create
```



```Ruby
# config/routes.rb
Rails.application.routes.draw do
    # root 페이지를 home/index페이지로 설정.
    # 처음 사이트 들어가면 나오는 페이지 == root페이지
    root 'home#index'

    get 'home/index'
    # get 'home/index' => 'home#index'
    # home컨트롤러로 이동해서 index액션을 보여주게되고 결과적으로 idex.html.erb 뷰 파일을 찾아 보여준다.
    get 'home/new'
    # get 'home/new' => 'home#new'
    get 'home/create'
    # get 'home/create' => 'home#create'
end
```

### index.html.erb파일
```html
<!--  views/home/index.html.erb -->
<h1>전체 글 목록입니다.</h1>
<a href="/home/new">새 글 쓰기 </a>
```
### new.html.erb파일
```html
<!-- views/home/new.html.erb -->
<!-- home/create로 정보전달 -->
<!-- form태그에 method를 따로 적어주지않을 경우 get방식으로 요청 -->
<form action='/home/create' method='post'>
    제목: <input type='text' name='post_title'><br><br>
    내용: <textarea name="post_content"></textarea><br>
    <input type="submit" value="제출">
</form>
```

## url 요청방식에 따른 차이
### get 방식
: 입력한 정보를 **url에 노출**(정보 보여줘도 상관 없을 때)
```Ruby
get 'home/index'
# get 'home/new' => 'home#new' 
```
### post 방식
: 입력한 정보를 **숨겨서 보냄**(정보를 보여주면 안 될 때)
```Ruby
post 'home/index'
# post 'home/new' => 'home#new'
```



###  form 태그 참고
- form 태그는 정보를 제출하기 위한 대화형 컨트롤을 포함하는 문서 구획을 나타낸다. 
- 웹 서버에 정보를 제출하기 위한 양식의 범위를 정의
- form태그 밑에 다른 form태그 올 수 없다.
- action 속성은 전송할 정보를 처리할 웹페이즤 url을 적는 속성,값은 url

## CSRF
: 웹 페이지에 악성 코드나 링크를 포함하는 공격 방법

<br>
CSRF 공격을 방지하기 위해서 보안 token을 사용(Django에도 csrf_token 있는데 목적 동일하다.)

```html
<form action='/home/create' method='POST'>
    <!-- ror에서의 보안토큰 -->
    <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
    제목: <input type="text" name="post_title"> <br><br>
    내용: <textarea name="post_content"></textarea><br>
    <input type="submit" value="제출">
</form>
```
- hidden_field_tag : 숨겨져서 날아가는 태그 
: 확인하고 싶다면 form의 action속성에 url로 이동하는 erb파일에 params 찍어서 보안토큰 앞부분 들어간 것을 확인할 수 있다.
- form_authenticity_token

## rails에서만 사용하는 form_for 가 있는데 보안토큰까지 안전하게 처리해준다. (나중에 학습할 것.)
# MVC-Delete

## CRUD의 Delete기능 

### 전에 만들었던 create.html.erb 사실상 뷰파일은 볼 필요가 없다.
- why? : params를 통해서 어떻게 데이터가 전송되는지 확인하려고 했을뿐
- 실질적으로는 home컨트롤러의 create액션에서 정보를 보여주고 index액션으로 화면을 전송하기 때문에 굳이 view파일을 볼 필요가 없어 삭제. (굳이 view파일을 작성할 필요 X)

```Ruby
# routes.rb 파일
Rails.application.routes.draw do
    root "home#index"

    get 'home/index'

    get 'home/new'

    post 'home/create'

    # 'home#destroy' 와 같은 의미
    get 'home/destroy'
end
```

컨트롤러에 destroy액션을 작성했다. <br>
하지만 문제점이 발생한다.

```Ruby
# home_controller.rb 파일
class HomeController < ApplicationController
    def index
        @posts = Post.all
    end

    def new
    end

    def create
        @post = Post.new
        @post.title = params[:post_title]
        @post.content = params[:post_content]
        @post.save

        redirect_to "/home/index"
    end

    # 문제의 destroy액션
    def destroy 
        # destroy_all method를 사용하여 Post의 모든 행 제거해버렸다.
        Post.destroy_all
        redirect_to "/home/index"
    end
end
```


### 우리가 한 것 == "전체" 게시물의 삭제
### 원하는 것 == "특정" 게시물의 삭제 (개별적인 게시물의 삭제를 요구)

### id == 주민등록번호 와 같이 특정한 누군가를 나타내기 위한 수단으로 "id"를 필요로 한다. 

### id는 .save를 수행하면서 테이블에 자동으로 생성!!
### url로 destroy action에 id를 전달하도록 하자.

```html
<!-- index.html.erb파일 -->
<%@posts.each do |p|%>        <!-- p는 post테이블의 각 행 -->
    제목: <%=p.title%><br>    
    내용: <%=p.content%><br>
    <a href='/home/destroy/<%=p.id%>'>삭제</a><br>
    -------------------<br>
<%end%>
```
- @posts 객체에 담긴 데이터들을 한 줄씩 p 에 담아서 제목과 내용을 추출한다.
- p말고 아무 변수나 사용해도 상관없다.(단지 변수이름일뿐.)

```Ruby
# routes.rb 수정

get 'home/destry/:post_id' => 'home#destry'
```

### /post_id 
- ```주소가 그냥 문자열 그대로 /post_id로 이동```

### /:post_id
- ```/destroy/1, /destory/2와 같이 게시물의 id를 post_id 변수에 저장```



### 진짜 삭제 기능
```Ruby
# home_controller.rb파일

def destroy 
    # 지우고자하는 특정 게시물을  params의 id를 통해서 찾을 수 있다.
    @post = Post.find(params[:post_id])
    @post.destroy
    # 삭제 진행 후 index 루트페이지로 돌아간다. 
    # 따라서 delete.html.erb 뷰파일 사실상 존재할 필요 없으므로 삭제해주자.
    redirect_to '/home/index'
end
```
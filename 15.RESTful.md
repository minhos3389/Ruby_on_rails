# RESTful

실제 `scaffold`를 만들어보고, RESTful이라는 개녀에 대해서 이야기해보자.

## scaffold & RESTful

**scaffold** 사전적 의미는 뼈대,  scaffold를 통해서 <br>
`migration` / `model` / `routes` / `controller` / `view` 이 모든 것을 한번에 생성할 수 있다.

- 새 프로젝트 생성
```shell
# rails_sca라는 이름의 5.0.4버전의 새로운 rails 프로젝트 생성
rails _5.0.4_ new rails_sca

# rails new rails_sca하게 되면 설치해놓은 버전의 프로젝트가 생성되어 나는 rails 6.1.3.1 version으로 설치되었다.(rails -v으로 확인 가능)\
rails new rails_sca
```

새 프로젝트로 이동.
```shell
# 새 프로젝트로 이동
cd rails_sca
# 해당 경로에서 아톰 실행
atom .
```

## scaffold를 만드는 코드
```shell
# 이렇게 작성하면 모델이름은  post(단수) 가 되고 controller이름은 posts(복수)가 된다.
# 컨트롤러  이름은 만드는 model이름의 복수로 만들어주는 것이 관례이다.
rails g scaffold posts title:string content:text
# migration파일의 기본적인 설정
# 한 줄로 모든 것이 만들어지는 것을 확인할 수 있다.

```
- 모델이름은 `단수`가 되고
- 컨트롤러 이름은 `복수`

실행시키도록 하자.
> rails g scaffold posts title:string content:text

controller, view파일등이 자동으로 설정되어지고, routes.rb에는 root 경로만 입력해준다.
```Ruby
# routes.rb

root "posts#index"
```
#### 부연설명
- migration 파일을 보면, 전에 만들었던 프로젝트에서 post라는 테이블을 구성했던 것처럼 title과 content가 들어가 있는 것을 확인할 수 있다. 
- 이 테이블을 확정짓기 위해 `rake db:migrate`를 해주고, route에 들어가서 처음 보는 root페이지인 index를 설정해준다.
- 컨트롤러에 들어가보면 사용하는 액션들은 코드가 조금씩 다르더라도, 전부 이전 프로젝트에 직접 작성해 사용했던 것과 동일한 이름인 `index, new, create, destroy ,edit, update`로 동일하다.

```shell
# db테이블 확정
rake db:migrate

# 생성된 route경로 확인 (GET, POST방식적힌 route경로들 쭉 확인)
rake routes
```

### rake routes 를 통해서 나온 내용을 살펴보도록 하자.
```shell
 Prefiex  Verb   URI Pattern               Controller#Action
    root  GET    /                         posts#index
   posts  GET    /posts(.:format)          posts#index
          POST   /posts(.:format)          posts#create
new_post  GET    /posts/new(.:format)      posts#new
edit_post GET    /posts/:id/edit(.:format) posts#edit
    post  GET    /posts/:id(.:format)      posts#show
          PATCH  /posts/:id(.:format)      posts#update
          PUT    /posts/:id(.:format)      posts#update
          DELETE /posts/:id(.:format)     posts#destroy
```


- Prefix는 이전에 routes.rb에서 route를 AS 로 설정한 명칭의미.


```Ruby
# routes.rb
Rails.application.routes.draw do
    root "posts#index"

    resources :posts
end
```
- 전 프로젝트에서는 직접 작성했던 routes.rb 파일 내용들이 `scaffold`를 사용했을 때는 `resources:posts` 한줄로 작성되었다는 것을 알 수 있다.

## RESTful
### `RE`prentational `S`tate `T`ransfer
### 표현 가능한 상태 이동
### `무엇`을 `어떻게` 할 지 표현
### 무엇: resource/ 어떻게: HTTP method

### resource : crud할 수 있는 정보 (생성하고 작성하고 수정하고 삭제할 수 있는 정보들)

- crud: create, read, update, delete
### HTTP method : 추출(GET)/생성(POST)/변경(PUT/PATCH)/삭제(DELETE)

|HTTP method| Route 이름(as)| 넘기는 값| controller#action | 목적 |
|:--|:--|:--|:--|:--|
|GET|post_path||index|모든 게시물 목록|
|GET|post_path|id|show|특정 게시물 보여줌|
|GET|new_post_path||new|새 글 쓰기|
|POST|posts_path|입력한 정보|create|새 게시물 생성|
|GET|edit_post_path|id|edit|수정 페이지|
|PUT/PATCH|post_path|id + 입력한 정보|update|수정 내용 반영|
|DELETE|post_path|id|destroy|게시물 삭제|

이전까지 우리가 사용해왔던 액션까지 일일이 알려주는 코드는 번거로웠다.

```Ruby
# routes.rb 이전의 코드 회상해보기
get '/posts/index' => 'posts#index'
get '/posts/new' => 'posts#new'
post '/posts/create' => 'posts#create'
get '/posts/desetroy/:post_id' => 'posts#destroy'
get '/posts/edit/:post_id' => 'posts#edit'
post '/posts/update/:post_id' => 'posts#update'
```

```
resource는 자원이란 뜻이다.
rails에서 resource는 CRUD할 수 있는 정보, 그러니까 생성하고 읽고 수정하고 지울 수 있는 정보를 의미.
우리가 만들어왔던 하나의 게시물이나 혹은 하나의 댓글 또는 하나의 유저가 모두 resource라고 할 수 있다.

HTTP method는 이 resource들에 하는 행위들이다.
앞서 말했듯, 우리는 이 게시물을 추출하거나 생성하고 또 변경하거나 제거할 수 있을 겁이다.
그래서 URI 패턴이 같더라도, 우리는 HTTP method를 통해서 이게 어떤 동작을 원하는지 알 수가 있는 것이다.

route의 이름이 같더라도 이 `HTTP method`에 따라서 uri를 통해 가게 되는 액션이 `다르다`.
이 HTTP method를 이용해서 같은 URL를 가져오더라도 목적에 따라 다른 줄을 서게 하면 좀더 처리하는 입장에서 쉬워진다.
어디에 줄을 섰느냐에 따라서 서버는 이 사람들이 어떤 걸 원하는지를 바로 파악할 수가 있을것이다.
이러한 장점 떄문에 HTTP method는 널리 쓰이고 있다.

당장 index 페이지를 보시면 같은 경로더라도 method에 따라서 다른 액션으로 이동하는 걸 볼 수 있다. 
그런데 또 여기서 그냥 post 하나만 덩그러니 놓여져 있는 걸 볼 수 있다. 분명 link_to를 사용할 때는 문자열 뒤에 URL이 온다고 했는데 말이다.

(중요) 이 post는 each do~end 문 안에서 하나의 게시물을 가리키는 녀석이죠. 그리고 우리는 이 post라는 게시물 하나에 대해서만 지우든, 고치든 어떤 작업을 수행할 겁니다. 그렇기 때문에 우리는 이 녀석을 post_path(id: post.id)라고도 쓸 수가 있어요. 그리고 따로 method를 안써주면 기본적으로 method는 get으로 처리되기 때문에 이 표에서 보는 것처럼 show라는, 하나의 게시물을 보여주는 녀석으로 이동을 하게 됩니다.
```
- index.html.erb 파일
```html
<% @posts.each do |post| %>
    <tr>
        <td><%= post.title %></td>
        <td><%= post.content %></td>
        <!-- <%= link_to 'Show', post_path(post), method: :get %>과 동일. Rails에서 post로 축약가능.-->
        <td><%= link_to 'Show', post %></td>
        <td><%= link_to 'Edit', edit_post_path(post) %></td>
        <td><%= link_to 'Destroy', post, method: :delete, data: { confirm: " Are you sure? " %></td>
    </tr>
```
- **post는 `post_path(id: post.id)` 또는 `post_path(post)`와 같음
- **따로 method 안써주면 기본 메소드는 get

- link_to를 사용할 경우, 문자열 뒤에 url을 적어줘야한다고 했었는데 post만 덩그라니 놓여있는 것을 볼 수 있다. <br>
헤메는 부분이 될 수 있다. 여기서 post는 each do 구문을 통해 하나의 게시물이 post에 담긴 상태이다.

- post는 하나의 게시물이므로, method만 주면 이에 알맞은 url로 보내준다는 것.

- link_to에서 method를 따로안적을 경우 default는 GET이다.